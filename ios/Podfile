# ios/Podfile
platform :ios, '15.5'

# Tell Flutter where it is
flutter_root = File.expand_path('..', File.dirname(`which flutter`))
require File.expand_path(File.join('packages', 'flutter_tools', 'bin', 'podhelper'), flutter_root)

flutter_ios_podfile_setup

target 'Runner' do
  # DO NOT enable use_frameworks! unless you absolutely need it.
  # keep static linking; that's Flutter's default and works fine.

  ▶ use_modular_headers!   # <— THE IMPORTANT BIT

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))

  # If you have unit/UI test targets, they go here too.
end

post_install do |installer|
  flutter_additional_ios_build_settings(installer)

  # Keep deployment target & C++ settings sane for Firestore/grpc
  installer.pods_project.targets.each do |t|
    t.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.5'
      config.build_settings['CLANG_CXX_LANGUAGE_STANDARD'] = 'gnu++17'
      config.build_settings['CLANG_CXX_LIBRARY'] = 'libc++'
    end
  end

  # Flutter ships this in newer templates; safe to call if present
  if defined?(__apply_Xcode_16_compatibility_fix)
    __apply_Xcode_16_compatibility_fix(installer)
  end
end
